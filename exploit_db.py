from selenium import webdriver
import time
import pandas as pd

PATH = "/usr/local/bin/chromedriver" # Chromedriver address

exploid_id  = [] 
page_num    = []
titles      = []
EDB_IDs     = []
CVEs        = []
authors     = []
types       = []
platforms   = []
dates       = []

def details(index):
    driver = webdriver.Chrome(PATH) # Open Chrome by chromedriver
    driver.get("https://www.exploit-db.com/") # Get link web
    time.sleep(2) # Do anything after 3 seconds 
    exploid_element = driver.find_element_by_xpath(f'//*[@id="exploits-table"]/tbody/tr[{index}]/td[5]/a')
    exploid_element.click()
    time.sleep(2)

    # Save data from web into file .txt
    detail_of_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[2]/div[1]/div/pre/code')
    f = open(f'Detail_of_element_{index}.txt', 'w', True)
    f.write(detail_of_element.text)

    driver.close()
    

def lists(row):
    driver = webdriver.Chrome(PATH) # Open Chrome by chromedriver
    driver.get("https://www.exploit-db.com/") # Get link web
    time.sleep(2) # Do anything after 3 seconds
    exploid_element = driver.find_element_by_xpath(f'//*[@id="exploits-table"]/tbody/tr[{row}]/td[5]/a')
    exploid_element.click()
    time.sleep(2)

    # Title
    title_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[1]/h1')
    titles.append(title_element.text)

    # EDB_ID
    edb_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[1]/div/div[1]/div/div/div/div[1]/h6')
    EDB_IDs.append(edb_element.text)

    # CVE
    cve_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[1]/div/div[1]/div/div/div/div[2]/h6')
    CVEs.append(cve_element.text)

    # Author
    author_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[2]/div/div[1]/div/div/div/div[1]/h6/a')
    authors.append(author_element.text)

    # Type
    type_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[2]/div/div[1]/div/div/div/div[2]/h6/a')
    types.append(type_element.text)

    # Platform
    platform_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[3]/div/div[1]/div/div/div/div[1]/h6/a')
    platforms.append(platform_element.text)

    # Date 
    date_element = driver.find_element_by_xpath('/html/body/div[1]/div[2]/div[2]/div/div/div[1]/div/div[2]/div[1]/div[3]/div/div[1]/div/div/div/div[2]/h6')
    dates.append(date_element.text)

    driver.close()

# Menu
def menu():
    option = True
    while option != 0:
        print("--------------MENU----------------")
        print("\n1. Giao diện chi tiết exploit")
        print("\n2. Danh sách các trang exploit")
        print("\n0. Kết thúc chương trình")
        print("\n---------------------------------")
        option = int(input("Nhập lựa chọn: "))
        if option == 1:
            n = int(input('\nSố giao diện chi tiết mong muốn: '))
            for i in  range (1, n+1):
                details(i)
            print("\n==> In thành công!")
        elif option == 2:
            n = int(input('\nSố lượng exploit muốn liệt kê: '))
            for i in range (1, n+1):
                lists(i)

            # Save list into file excel
            data = pd.DataFrame({"EBD-ID": EDB_IDs, "CVE": CVEs, "Author": authors, 
                                "Type": types, "Platform": platforms, "Date": dates})
            data.to_csv(f"List_{n}_exploits.csv", index=False, encoding="utf-8")
            print("\n==> Khởi tạo danh sách thành công!")
        elif option == 0:
            print('--------------The End--------------')
            break
        else:
            print('\n*****Không có lựa chọn! Mời bạn chọn lại!*****')
            
        
        
if __name__ == "__main__":
    menu()

'''
Ví dụ: 
- In dữ liệu chi tiết của 2 trang exploit 
- In danh sách gồm 3 exploit 
'''